name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
# on:
#   push:
#     branches:
#       - main
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Maven clean
        working-directory: ./backend
        run: |
          ls ${{ github.workspace }}/backend
          mvn clean

      - uses: actions/checkout@v3
      - name: Make target folder on backend
        # working-directory: ./backend
        run: |
          mkdir -p /backend/src/main/resources/static

      - uses: actions/checkout@v3
      - name: Build vue project
        working-directory: ./frontend
        run: |
          npm install
          npm run build -- --dest ../backend/src/main/resources/static

      - uses: actions/checkout@v3
      - name: Setup Java 17
        uses: actions/setup-java@v1
        with:
          java-version: 17

      - name: Maven package
        working-directory: ./backend
        run: |
          mvn package

      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}/backend/src/main/resources/static

      - name: Deploy file to server
        uses: wlixcc/SFTP-Deploy-Action@v1.2.4
        with:
          username: vraptor
          server: 175.196.170.100
          port: 10022
          ssh_private_key: ${{ secrets.SSH_PRIVATE_KEY }}
          local_path: './backend/target/*.jar'
          remote_path: '/home/vraptor/teruteru'
          sftp_only: true
          password: vraptor
